<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 1.6.1">
<meta name="crystal_docs.project_version" content="master-dev">
<meta name="crystal_docs.project_name" content="goban">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="goban">
  <title>goban master-dev</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          goban
        </a>
      </h1>

      <span class="project-version">
        master-dev
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="goban/Goban" data-name="goban">
      <a href="Goban.html">Goban</a>
      
        <ul>
  
  <li class=" " data-id="goban/Goban/BitStream" data-name="goban::bitstream">
      <a href="Goban/BitStream.html">BitStream</a>
      
    </li>
  
  <li class="parent " data-id="goban/Goban/ECC" data-name="goban::ecc">
      <a href="Goban/ECC.html">ECC</a>
      
        <ul>
  
  <li class=" " data-id="goban/Goban/ECC/Level" data-name="goban::ecc::level">
      <a href="Goban/ECC/Level.html">Level</a>
      
    </li>
  
  <li class=" " data-id="goban/Goban/ECC/RSGenerator" data-name="goban::ecc::rsgenerator">
      <a href="Goban/ECC/RSGenerator.html">RSGenerator</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="goban/Goban/MQR" data-name="goban::mqr">
      <a href="Goban/MQR.html">MQR</a>
      
        <ul>
  
  <li class=" " data-id="goban/Goban/MQR/Version" data-name="goban::mqr::version">
      <a href="Goban/MQR/Version.html">Version</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="goban/Goban/PNGExporter" data-name="goban::pngexporter">
      <a href="Goban/PNGExporter.html">PNGExporter</a>
      
    </li>
  
  <li class="parent " data-id="goban/Goban/QR" data-name="goban::qr">
      <a href="Goban/QR.html">QR</a>
      
        <ul>
  
  <li class=" " data-id="goban/Goban/QR/Canvas" data-name="goban::qr::canvas">
      <a href="Goban/QR/Canvas.html">Canvas</a>
      
    </li>
  
  <li class=" " data-id="goban/Goban/QR/CanvasDrawer" data-name="goban::qr::canvasdrawer">
      <a href="Goban/QR/CanvasDrawer.html">CanvasDrawer</a>
      
    </li>
  
  <li class=" " data-id="goban/Goban/QR/Mask" data-name="goban::qr::mask">
      <a href="Goban/QR/Mask.html">Mask</a>
      
    </li>
  
  <li class=" " data-id="goban/Goban/QR/Version" data-name="goban::qr::version">
      <a href="Goban/QR/Version.html">Version</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="goban/Goban/Segment" data-name="goban::segment">
      <a href="Goban/Segment.html">Segment</a>
      
        <ul>
  
  <li class=" " data-id="goban/Goban/Segment/Mode" data-name="goban::segment::mode">
      <a href="Goban/Segment/Mode.html">Mode</a>
      
    </li>
  
  <li class=" " data-id="goban/Goban/Segment/Optimizer" data-name="goban::segment::optimizer">
      <a href="Goban/Segment/Optimizer.html">Optimizer</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="goban/Goban/SVGExporter" data-name="goban::svgexporter">
      <a href="Goban/SVGExporter.html">SVGExporter</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><a id="goban" class="anchor" href="#goban">  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Goban</h1>
<p>A fast and efficient QR Code encoder library written purely in Crystal. It is significantly faster (4.75x) and uses fewer heap allocations (-94.7%) compared to the other implementation in Crystal (<a href="https://github.com/spider-gazelle/qr-code">spider-gazelle/qr-code</a>), and it supports wider QR Code standard features such as Kanji mode encoding.</p>
<p>The implementation is based on <a href="https://www.iso.org/standard/62021.html">ISO/IEC 18004:2015</a>/<a href="https://webdesk.jsa.or.jp/books/W11M0090/index/?bunsyo_id=JIS+X+0510:2018">JIS X 0510:2018</a> standard and is independent of other implementations for the most part. However, the optimal text segmentation algorithm is made possible thanks to the following article: <a href="https://www.nayuki.io/page/optimal-text-segmentation-for-qr-codes">Optimal text segmentation for QR Codes</a>.</p>
<p>The name comes from the board game <a href="https://en.wikipedia.org/wiki/Go_(game)">Go</a>, which inspired the QR Code inventor to come up with a fast and accurate matrix barcode to read. 碁盤(Goban) literally means <a href="https://en.wikipedia.org/wiki/Go_equipment#Board">Go board</a> in Japanese.</p>
<h2><a id="benchmark" class="anchor" href="#benchmark">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Benchmark</h2>
<p>Comparing it/s and heap allocations between Goban and <a href="https://github.com/spider-gazelle/qr-code">spider-gazelle/qr-code</a>:</p>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;benchmark&quot;</span>
<span class="k">require</span> <span class="s">&quot;qr-code&quot;</span>
<span class="k">require</span> <span class="s">&quot;goban&quot;</span>

<span class="t">Benchmark</span>.ips <span class="k">do</span> <span class="o">|</span>x<span class="o">|</span>
  x.report(<span class="s">&quot;qr-code&quot;</span>) { <span class="t">QR</span>.new(<span class="s">&quot;Hello World!&quot;</span>, level: <span class="n">:h</span>) }
  x.report(<span class="s">&quot;goban&quot;</span>) { <span class="t">Goban</span><span class="t">::</span><span class="t">QR</span>.encode_string(<span class="s">&quot;Hello World!&quot;</span>, <span class="t">Goban</span><span class="t">::</span><span class="t">ECC</span><span class="t">::</span><span class="t">Level</span><span class="t">::</span><span class="t">High</span>) }
<span class="k">end</span></code></pre>
<pre><code class="language-crystal">qr<span class="o">-</span>code   <span class="n">3.40</span>k (<span class="n">293.86</span>µs) (± <span class="n">1.74</span><span class="o">%</span>)   <span class="n">149</span>kB<span class="o">/</span>op   <span class="n">4.75</span>× slower
  goban  <span class="n">16.18</span>k ( <span class="n">61.81</span>µs) (± <span class="n">1.65</span><span class="o">%</span>)  <span class="n">8.08</span>kB<span class="o">/</span>op        fastest</code></pre>
<h2><a id="features" class="anchor" href="#features">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Features</h2>
<ul>
<li>[x] Encoding a sequence of text segments
<ul>
<li>[x] Numeric mode</li>
<li>[x] Alphanumeric mode</li>
<li>[x] Byte mode</li>
<li>[x] Kanji mode</li>
<li>[ ] ECI mode</li>
</ul>
</li>
<li>[x] Building optimized text segments from a string</li>
<li>[x] Error correction coding using Reed-Solomon Codes</li>
<li>[x] Data masking with all 8 mask patterns</li>
<li>[x] Support for all QR Code versions from 1 to 40</li>
<li>[ ] Structured append of symbols</li>
<li>[ ] Micro QR Code (In development)</li>
<li>[ ] rMQR Code (Not a part of ISO/IEC 18004:2015 standard but planned)</li>
</ul>
<p>Goban will not support the generation of QR Code Model 1 symbols as it is considered obsolete.</p>
<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>
<ol>
<li>
<p>Add the dependency to your <code>shard.yml</code>:</p>
<pre><code class="language-yaml">dependencies:
  goban:
    github: soya-daizu/goban</code></pre>
</li>
<li>
<p>Run <code>shards install</code></p>
</li>
</ol>
<h2><a id="usage" class="anchor" href="#usage">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h2>
<p>A simple example to generate a QR Code for the given string and output to the console:</p>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;goban&quot;</span>

qr <span class="o">=</span> <span class="t">Goban</span><span class="t">::</span><span class="t">QR</span>.encode_string(<span class="s">&quot;Hello World!&quot;</span>, <span class="t">Goban</span><span class="t">::</span><span class="t">ECC</span><span class="t">::</span><span class="t">Level</span><span class="t">::</span><span class="t">Low</span>)
qr.print_to_console
<span class="c"># =&gt; ██████████████  ████    ██  ██████████████</span>
<span class="c">#    ██          ██    ██    ██  ██          ██</span>
<span class="c">#    ██  ██████  ██  ██  ██  ██  ██  ██████  ██</span>
<span class="c">#    ██  ██████  ██  ██    ██    ██  ██████  ██</span>
<span class="c">#    ██  ██████  ██  ██████      ██  ██████  ██</span>
<span class="c">#    ██          ██              ██          ██</span>
<span class="c">#    ██████████████  ██  ██  ██  ██████████████</span>
<span class="c">#                      ████</span>
<span class="c">#    ████████    ██  ██  ██    ██    ██████  ██</span>
<span class="c">#    ██████████    ██  ██    ██████████████  ██</span>
<span class="c">#        ██    ████    ██    ████  ██      ████</span>
<span class="c">#    ████  ██      ██████    ██    ██  ██  ██</span>
<span class="c">#    ████  ██████████  ██████  ████          ██</span>
<span class="c">#                    ████████    ████    ██  ██</span>
<span class="c">#    ██████████████      ██    ████████</span>
<span class="c">#    ██          ██    ██████████  ██  ████</span>
<span class="c">#    ██  ██████  ██    ██  ██          ██████</span>
<span class="c">#    ██  ██████  ██  ██  ██  ██  ██    ██████</span>
<span class="c">#    ██  ██████  ██  ██████  ██    ██    ██</span>
<span class="c">#    ██          ██  ██    ██  ████████      ██</span>
<span class="c">#    ██████████████  ██    ██  ██████    ██</span></code></pre>
<h3><a id="using-exporters-to-generate-a-png-and-svg-image" class="anchor" href="#using-exporters-to-generate-a-png-and-svg-image">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Using exporters to generate a PNG and SVG image</h3>
<p>To generate a PNG image, add <a href="https://github.com/stumpycr/stumpy_png">stumpy_png</a> as a dependency in your shard.yml, and <code>require &quot;goban/exporters/png&quot;</code> to use <code><a href="Goban/PNGExporter.html">Goban::PNGExporter</a></code>:</p>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;goban/exporters/png&quot;</span>

qr <span class="o">=</span> <span class="t">Goban</span><span class="t">::</span><span class="t">QR</span>.encode_string(<span class="s">&quot;Hello World!&quot;</span>)
puts <span class="s">&quot;Exporting with targeted size: 500&quot;</span>
size <span class="o">=</span> <span class="t">Goban</span><span class="t">::</span><span class="t">PNGExporter</span>.export(qr, <span class="s">&quot;output.png&quot;</span>, <span class="n">500</span>)
puts <span class="s">&quot;Actual QR Code size: </span><span class="i">#{</span>size<span class="i">}</span><span class="s">&quot;</span></code></pre>
<p><code><a href="Goban/SVGExporter.html">Goban::SVGExporter</a></code> requires no external dependency and can be used like below:</p>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;goban/exporters/svg&quot;</span>

qr <span class="o">=</span> <span class="t">Goban</span><span class="t">::</span><span class="t">QR</span>.encode_string(<span class="s">&quot;Hello World!&quot;</span>)
<span class="c"># Get SVG string</span>
puts <span class="t">Goban</span><span class="t">::</span><span class="t">SVGExporter</span>.svg_string(qr, <span class="n">4</span>)
<span class="c"># or export as a file</span>
<span class="t">Goban</span><span class="t">::</span><span class="t">SVGExporter</span>.export(qr, <span class="s">&quot;test.svg&quot;</span>)</code></pre>
<h3><a id="about-the-automatic-text-segmentation" class="anchor" href="#about-the-automatic-text-segmentation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>About the automatic text segmentation</h3>
<p>The <code>Goban::QR.encode_string()</code> method encodes a string to an optimized sequence of text segments where each segment is encoded in one of the following encoding modes:</p>
<p>| Mode | Supported Characters |
| --- | --- |
| Numeric | 0-9 |
| Alphanumeric | 0-9 A-Z \s $ % * + - . / : |
| Byte | Any UTF-8 characters |
| Kanji | Any Shift-JIS characters |</p>
<p>The <code>Byte</code> mode supports the widest range of characters but it is inefficient and produces longer data bits, meaning that when comparing the two QR Code symbols, one encoded entirely in the <code>Byte</code> mode and the other encoded in the appropriate mode for each character*, the former one can be more challenging to scan and decode than the other given that both symbols are printed in the same size.</p>
<p>* Because each text segment includes additional header bits to indicate its encoding mode, simply encoding each character in the supported mode that has the smallest character set may not always produce the most optimal segments. Goban addresses this by using the technique of dynamic programming.</p>
<p>Finding out the optimal segmentation requires some processing, so if you are generating thousands of QR Codes with all the same limited sets of characters, you may want to hard-code the text segments and apply the characters to those to generate the QR Codes.</p>
<p>This can be done by using the <code>Goban::QR.encode_segments()</code> method, which is the lower-level method used by the <code>Goban::QR.encode_string()</code> method.</p>
<pre><code class="language-crystal">segments <span class="o">=</span> [
  <span class="t">Goban</span><span class="t">::</span><span class="t">Segment</span>.kanji(<span class="s">&quot;こんにち&quot;</span>),
  <span class="t">Goban</span><span class="t">::</span><span class="t">Segment</span>.byte(<span class="s">&quot;wa&quot;</span>),
  <span class="t">Goban</span><span class="t">::</span><span class="t">Segment</span>.kanji(<span class="s">&quot;、世界！&quot;</span>),
  <span class="t">Goban</span><span class="t">::</span><span class="t">Segment</span>.alphanumeric(<span class="s">&quot; 123&quot;</span>),
]
<span class="c"># Note that when using this method, you have to manually assign the version (= size) of the QR Code.</span>
qr <span class="o">=</span> <span class="t">Goban</span><span class="t">::</span><span class="t">QR</span>.encode_segments(segments, <span class="t">Goban</span><span class="t">::</span><span class="t">ECC</span><span class="t">::</span><span class="t">Level</span><span class="t">::</span><span class="t">Low</span>, <span class="t">Goban</span><span class="t">::</span><span class="t">QR</span><span class="t">::</span><span class="t">Version</span>.new(<span class="n">2</span>))</code></pre>
<p>The optimal segments and version to hard-code can be figured out by using the <code>Goban::Segment::Optimizer.make_optimized_segments()</code> method.</p>
<h2><a id="api-documentations" class="anchor" href="#api-documentations">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>API Documentations</h2>
<p>The API docs for the current master branch are available from the link below:</p>
<p><a href="https://soya-daizu.github.io/goban/">API docs</a></p>
<p>You may want to first look at the <code><a href="Goban/QR.html">Goban::QR</a></code> or one of the exporters (<code><a href="Goban/PNGExporter.html">Goban::PNGExporter</a></code> and <code>Goban::SVGExporters</code>) to understand how to use this library.</p>
<h2><a id="contributing" class="anchor" href="#contributing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributing</h2>
<ol>
<li>Fork it (<a href="https://github.com/soya-daizu/goban/fork">https://github.com/soya-daizu/goban/fork</a>)</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create a new Pull Request</li>
</ol>
<h2><a id="contributors" class="anchor" href="#contributors">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributors</h2>
<ul>
<li><a href="https://github.com/soya-daizu">soya_daizu</a> - creator and maintainer</li>
</ul>
</div>
</body>
</html>
